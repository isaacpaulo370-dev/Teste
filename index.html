<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cadeados por Continente</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <style>
    :root{ --bg:#e9f0ff; }
    body{ margin:0; font-family:system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:linear-gradient(160deg,var(--bg),#d6e7ff); }
    .center-screen{ display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .card{ background:#fff; padding:24px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.08); text-align:center; max-width:720px; width:92%; }
    .card h1{ margin:0 0 12px 0; font-size:20px; }
    .card p{ margin:0 0 16px 0; }
    input{ padding:10px 12px; border-radius:8px; border:1px solid #ccc; width:60%; max-width:320px; margin-right:8px; }
    button{ padding:10px 14px; border-radius:8px; border:none; background:#2563eb; color:#fff; font-weight:600; cursor:pointer; }
    #map{ height:75vh; width:100%; display:none; }
    .topbar{ position:fixed; left:12px; top:12px; z-index:1000; background:#fff; padding:8px 12px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    .lock-count{ font-weight:700; }
    .leaflet-container{ border-radius:8px; }
    .hint{ font-size:13px; color:#555; margin-top:8px; }
  </style>
</head>
<body>

  <div class="center-screen" id="intro">
    <div class="card">
      <h1>Estamos no continente que muitos pensam que é um país</h1>
      <p>Digite a senha para exibir o mapa com os cadeados nos continentes.</p>
      <div>
        <input id="introInput" placeholder="Digite a senha...">
        <button id="introBtn">Entrar</button>
      </div>
      <div id="introMsg" style="margin-top:10px;font-weight:700;color:crimson;"></div>
    </div>
  </div>

  <div id="mapArea" style="display:none; padding:12px;">
    <div class="topbar">Cadeados desbloqueados: <span class="lock-count" id="count">0</span>/6</div>
    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script>
    // senha inicial
    const introPassword = 'continentes';

    const introInput = document.getElementById('introInput');
    const introBtn = document.getElementById('introBtn');
    const introMsg = document.getElementById('introMsg');
    const introDiv = document.getElementById('intro');
    const mapArea = document.getElementById('mapArea');

    introBtn.addEventListener('click', tryIntro);
    introInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryIntro(); });

    function tryIntro(){
      const val = (introInput.value||'').trim().toLowerCase();
      if(val === introPassword.toLowerCase()){
        // mostrar mapa
        introDiv.style.display = 'none';
        mapArea.style.display = 'block';
        document.getElementById('map').style.display = 'block';
        initMap();
      } else {
        introMsg.textContent = 'Senha incorreta. Tente novamente.';
      }
    }

    // ----- Map & locks -----
    let map;
    const continentLocks = [
      { id:'america', title:'América', coords:[40.7128, -74.0060], password:'123', unlocked:false },
      { id:'europa', title:'Europa', coords:[51.5074, -0.1278], password:'123', unlocked:false },
      { id:'oceania', title:'Oceania', coords:[-33.8688,151.2093], password:'123', unlocked:false },
      { id:'asia', title:'Ásia', coords:[35.6762,139.6503], password:'123', unlocked:false },
      { id:'africa', title:'África', coords:[-1.2921,36.8219], password:'123', unlocked:false },
      { id:'antarctica', title:'Antártica', coords:[-82, 135], password:'123', unlocked:false }
    ];

    let unlockedCount = 0;

    function initMap(){
      map = L.map('map', { zoomControl:true }).setView([20,0], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

      continentLocks.forEach(lock => {
        lock.marker = L.marker(lock.coords, { icon: L.divIcon({ className:'lock-marker', html:'🔒', iconSize:[32,32] }) }).addTo(map);

        const popupHtml = `
          <div style="min-width:220px;">
            <div style="font-weight:700;margin-bottom:6px;">${lock.title}</div>
            <div id="msg-${lock.id}"></div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:6px;">
              <input id="input-${lock.id}" placeholder="Senha" style="flex:1;padding:6px;border-radius:6px;border:1px solid #ccc;" />
              <button id="btn-${lock.id}" style="padding:6px 8px;border-radius:6px;border:none;background:#16a34a;color:#fff;cursor:pointer;">OK</button>
            </div>
          </div>
        `;

        lock.marker.bindPopup(popupHtml);

        lock.marker.on('popupopen', ()=>{
          const btn = document.getElementById('btn-'+lock.id);
          const input = document.getElementById('input-'+lock.id);
          const msg = document.getElementById('msg-'+lock.id);

          // If already unlocked
          if(lock.unlocked){
            msg.innerHTML = `<div style=\"color:green;font-weight:700;\">Desbloqueado — ${lock.title}</div>`;
            input.style.display = 'none';
            btn.style.display = 'none';
            return;
          }

          btn.onclick = ()=>{ attemptLock(lock, input.value, msg); };
          input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') attemptLock(lock, input.value, msg); });
        });
      });
    }

    function attemptLock(lock, attemptRaw, msgEl){
      const attempt = (attemptRaw||'').trim().toLowerCase();
      const correct = (lock.password||'').toLowerCase();
      if(attempt === correct){
        lock.unlocked = true;
        unlockedCount++;
        document.getElementById('count').textContent = unlockedCount;
        // update marker icon to unlocked
        lock.marker.setIcon(L.divIcon({ className:'lock-marker', html:'🔓', iconSize:[32,32] }));
        msgEl.innerHTML = `<div style=\"color:green;font-weight:700;\">Senha correta — ${lock.title}</div>`;
        // hide inputs
        const input = document.getElementById('input-'+lock.id);
        const btn = document.getElementById('btn-'+lock.id);
        if(input) input.style.display = 'none';
        if(btn) btn.style.display = 'none';

        // check completion
        if(unlockedCount === continentLocks.length){
          setTimeout(()=>{
            L.popup({closeOnClick:false,autoClose:false})
              .setLatLng(map.getCenter())
              .setContent('<div style="font-weight:700;">Parabéns — você desbloqueou todos os cadeados dos continentes!</div>')
              .openOn(map);
          },300);
        }
      } else {
        msgEl.innerHTML = `<div style=\"color:crimson;font-weight:700;\">Senha incorreta</div>`;
      }
    }
  </script>
</body>
</html>